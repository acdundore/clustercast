<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Local (Single-Series) Forecasting - Clustercast</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Local (Single-Series) Forecasting";
        var mkdocs_page_input_path = "example_single-series.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Clustercast
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Quick Start Examples</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Local (Single-Series) Forecasting</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../example_multi-series/">Global (Multi-Series) Forecasting</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../example_custom-regressor/">Using a Custom Base Regressor</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../example_exog-features/">Modeling with Exogenous Features</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../example_inspecting-data/">Inspecting Transformed Data</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Clustercast API</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../DirectForecaster/">DirectForecaster</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../RecursiveForecaster/">RecursiveForecaster</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../datasets/">.datasets</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Clustercast</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Quick Start Examples</li>
      <li class="breadcrumb-item active">Local (Single-Series) Forecasting</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="local-single-series-forecasting">Local (Single-Series) Forecasting</h1>
<p>In this example, we will use the well-known airline passengers dataset to perform a simple single-series forecast.
We will walk through data preparation, then show creation of both recursive and direct forecast models.</p>
<hr />
<h2 id="data-preparation">Data Preparation</h2>
<pre><code class="language-python"># imports
from clustercast.datasets import load_airline_passengers
from clustercast import DirectForecaster, RecursiveForecaster

# load airline passenger data 
airline_data = load_airline_passengers()
airline_data['ID'] = 1
print(airline_data)

# only keep data before 1959 for training
airline_data_train = airline_data.loc[
    airline_data['YM'] &lt; dt.datetime(year=1959, month=1, day=1)
]
</code></pre>
<pre><code class="language-profile">            YM  Passengers  ID
0   1949-01-01         112   1
1   1949-02-01         118   1
2   1949-03-01         132   1
3   1949-04-01         129   1
4   1949-05-01         121   1
..         ...         ...  ..
139 1960-08-01         606   1
140 1960-09-01         508   1
141 1960-10-01         461   1
142 1960-11-01         390   1
143 1960-12-01         432   1

[144 rows x 3 columns]
</code></pre>
<pre><code class="language-python"># plot the airline data
fig, ax = plt.subplots(figsize=(10, 4));
sns.lineplot(data=airline_data, x='YM', y='Passengers', ax=ax);
ax.grid(axis='both');
ax.set_title('Airline Passengers', fontsize=16);
</code></pre>
<p><img alt="Airline Data" src="../img/example_single-series_data.png" /></p>
<hr />
<h2 id="direct-forecaster">Direct Forecaster</h2>
<p>Now, let's create a direct forecaster.
Because the time series is non-stationary, we will take the log of the series and then include first order differencing.
We'll also use 12 lag features (a full year prior) and apply an ordinal seasonality feature that is 12 timesteps long.</p>
<pre><code class="language-python"># define the model
model = DirectForecaster(
    data=airline_data_train,
    endog_var='Passengers',
    id_var='ID',
    timestep_var='YM',
    group_vars=[],
    exog_vars=[],
    boxcox=0,
    differencing=True,
    lags=12,
    seasonality_ordinal=[12],
)

# show stationarity test
print(model.stationarity_test(test='adf'))

# fit the model with a 90% prediction interval
# 24 lookahead models, with 4 years of CQR calibration data
model.fit(max_steps=24, alpha=0.10, cqr_cal_size=48)

# make predictions out to 2 years ahead
direct_preds = model.predict(steps=24)

# display some predictions
print(direct_preds.head())
</code></pre>
<pre><code class="language-profile">   ID  Raw ADF p-value  Transformed ADF p-value
0   1         0.826794                 0.158228

   ID         YM    Forecast  Forecast_0.050  Forecast_0.950
0   1 1959-01-01  343.240852      318.309103      356.097399
1   1 1959-02-01  327.078275      291.315758      381.538205
2   1 1959-03-01  363.945743      296.112474      416.552425
3   1 1959-04-01  356.755783      314.271979      450.546157
4   1 1959-05-01  381.087484      333.984742      431.445450
</code></pre>
<p>As shown in the stationarity test results, the Augmented Dickey-Fuller test shows that the p-value after the data 
transformations is much closer to stationary than before, but it is still not quite passing the significance threshold of 0.05.
That is okay for this example.</p>
<pre><code class="language-python"># display the predictions, including the prediction intervals
fig, ax = plt.subplots(figsize=(10, 4));
sns.lineplot(data=airline_data, x='YM', y='Passengers', ax=ax);
sns.lineplot(data=direct_preds, x='YM', y='Forecast', ax=ax);
ax.grid(axis='both');
ax.set_title('Airline Passengers: Direct Forecast', fontsize=16);
ax.fill_between(x=direct_preds['YM'], y1=direct_preds.iloc[:, -2], y2=direct_preds.iloc[:, -1], alpha=0.2, color='orange');
</code></pre>
<p><img alt="Direct Forecast" src="../img/example_single-series_direct.png" /></p>
<hr />
<h2 id="recursive-forecaster">Recursive Forecaster</h2>
<p>Now, let's create a recursive forecaster model.
We will use the same parameters as we did with the direct forecaster.</p>
<pre><code class="language-python"># define the model
model = RecursiveForecaster(
    data=airline_data_train,
    endog_var='Passengers',
    id_var='ID',
    timestep_var='YM',
    group_vars=[],
    exog_vars=[],
    boxcox=0,
    differencing=True,
    lags=12,
    seasonality_ordinal=[12],
)

# fit the model with a 90% prediction interval
model.fit(alpha=0.10)

# make predictions out to 2 years ahead
recursive_preds = model.predict(steps=24)

# display some predictions
print(recursive_preds.head())
</code></pre>
<pre><code class="language-profile">   ID         YM    Forecast  Forecast_0.050  Forecast_0.950
0   1 1959-01-01  343.240852      323.130861      372.400399
1   1 1959-02-01  325.689354      297.579253      356.483323
2   1 1959-03-01  371.489560      333.035457      410.702360
3   1 1959-04-01  356.554110      317.830452      396.871775
4   1 1959-05-01  368.268217      320.869205      411.887196
</code></pre>
<pre><code class="language-python"># display the predictions, including the prediction intervals
fig, ax = plt.subplots(figsize=(10, 4));
sns.lineplot(data=airline_data, x='YM', y='Passengers', ax=ax);
sns.lineplot(data=recursive_preds, x='YM', y='Forecast', ax=ax);
ax.grid(axis='both');
ax.set_title('Airline Passengers: Recursive Forecast', fontsize=16);
ax.fill_between(x=recursive_preds['YM'], y1=recursive_preds.iloc[:, -2], y2=recursive_preds.iloc[:, -1], alpha=0.2, color='orange');
</code></pre>
<p><img alt="Recursive Forecast" src="../img/example_single-series_recursive.png" /></p>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href=".." style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../example_multi-series/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
